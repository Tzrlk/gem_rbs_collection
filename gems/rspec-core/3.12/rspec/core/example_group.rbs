module RSpec
  module Core
    # ExampleGroup and {Example} are the main structural elements of
    # rspec-core. Consider this example:
    #
    #     RSpec.describe Thing do
    #       it "does something" do
    #       end
    #     end
    #
    # The object returned by `describe Thing` is a subclass of ExampleGroup.
    # The object returned by `it "does something"` is an instance of Example,
    # which serves as a wrapper for an instance of the ExampleGroup in which it
    # is declared.
    #
    # Example group bodies (e.g. `describe` or `context` blocks) are evaluated
    # in the context of a new subclass of ExampleGroup. Individual examples are
    # evaluated in the context of an instance of the specific ExampleGroup
    # subclass to which they belong.
    #
    # Besides the class methods defined here, there are other interesting macros
    # defined in {Hooks}, {MemoizedHelpers::ClassMethods} and
    # {SharedExampleGroup}. There are additional instance methods available to
    # your examples defined in {MemoizedHelpers} and {Pending}.
    class ExampleGroup
      # rubocop:disable Style/ClassVars
      @@example_groups_configured: untyped

      self.@metadata: untyped

      self.@superclass_metadata: untyped

      self.@descendant_filtered_examples: untyped

      self.@_descendants: untyped

      self.@parent_groups: untyped

      self.@declaration_locations: untyped

      self.@user_metadata: untyped

      self.@currently_executing_a_context_hook: untyped

      self.@examples: untyped

      self.@children: untyped

      self.@before_context_ivars: untyped

      @__inspect_output: untyped

      extend Hooks

      include MemoizedHelpers

      extend MemoizedHelpers::ClassMethods

      include Pending

      extend SharedExampleGroup

      # Define a singleton method for the singleton class (remove the method if
      # it's already been defined).
      # @private
      def self.idempotently_define_singleton_method: (untyped name) { (?) -> untyped } -> untyped

      # The [Metadata](Metadata) object associated with this group.
      # @see Metadata
      def self.metadata: () -> untyped

      # Temporarily replace the provided metadata.
      # Intended primarily to allow an example group's singleton class
      # to return the metadata of the example that it exists for. This
      # is necessary for shared example group inclusion to work properly
      # with singleton example groups.
      # @private
      def self.with_replaced_metadata: (untyped meta) { () -> untyped } -> untyped

      # @private
      # @return [Metadata] belonging to the parent of a nested {ExampleGroup}
      def self.superclass_metadata: () -> untyped

      # @private
      def self.delegate_to_metadata: (*untyped names) -> untyped

      # @return [String] the current example group description
      def self.description: () -> untyped

      # Returns the class or module passed to the `describe` method (or alias).
      # Returns nil if the subject is not a class or module.
      # @example
      #     RSpec.describe Thing do
      #       it "does something" do
      #         described_class == Thing
      #       end
      #     end
      #
      def described_class: () -> untyped

      # @private
      # @macro [attach] define_example_method
      #   @!scope class
      #   @method $1
      #   @overload $1
      #   @overload $1(&example_implementation)
      #     @param example_implementation [Block] The implementation of the example.
      #   @overload $1(doc_string, *metadata)
      #     @param doc_string [String] The example's doc string.
      #     @param metadata [Array<Symbol>, Hash] Metadata for the example.
      #       Symbols will be transformed into hash entries with `true` values.
      #   @overload $1(doc_string, *metadata, &example_implementation)
      #     @param doc_string [String] The example's doc string.
      #     @param metadata [Array<Symbol>, Hash] Metadata for the example.
      #       Symbols will be transformed into hash entries with `true` values.
      #     @param example_implementation [Block] The implementation of the example.
      #   @yield [Example] the example object
      #   @example
      #     $1 do
      #     end
      #
      #     $1 "does something" do
      #     end
      #
      #     $1 "does something", :slow, :uses_js do
      #     end
      #
      #     $1 "does something", :with => 'additional metadata' do
      #     end
      #
      #     $1 "does something" do |ex|
      #       # ex is the Example object that contains metadata about the example
      #     end
      #
      #  @example
      #     $1 "does something", :slow, :load_factor => 100 do
      #     end
      #
      def self.define_example_method: (untyped name, ?::Hash[untyped, untyped] extra_options) -> untyped

      # @private
      # @macro [attach] define_example_group_method
      #   @!scope class
      #   @overload $1
      #   @overload $1(&example_group_definition)
      #     @param example_group_definition [Block] The definition of the example group.
      #   @overload $1(doc_string, *metadata, &example_implementation)
      #     @param doc_string [String] The group's doc string.
      #     @param metadata [Array<Symbol>, Hash] Metadata for the group.
      #       Symbols will be transformed into hash entries with `true` values.
      #     @param example_group_definition [Block] The definition of the example group.
      #
      #   Generates a subclass of this example group which inherits
      #   everything except the examples themselves.
      #
      #   @example
      #
      #     RSpec.describe "something" do # << This describe method is defined in
      #                                   # << RSpec::Core::DSL, included in the
      #                                   # << global namespace (optional)
      #       before do
      #         do_something_before
      #       end
      #
      #       before(:example, :clean_env) do
      #         env.clear!
      #       end
      #
      #       let(:thing) { Thing.new }
      #
      #       $1 "attribute (of something)" do
      #         # examples in the group get the before hook
      #         # declared above, and can access `thing`
      #       end
      #
      #       $1 "needs additional setup", :clean_env, :implementation => JSON do
      #         # specifies that hooks with matching metadata
      #         # should be be run additionally
      #       end
      #     end
      #
      # @see DSL#describe
      def self.define_example_group_method: (untyped name, ?::Hash[untyped, untyped] metadata) -> untyped

      # @private
      # @macro [attach] define_nested_shared_group_method
      #   @!scope class
      #
      #   @see SharedExampleGroup
      def self.define_nested_shared_group_method: (untyped new_name, ?::String report_label) -> untyped

      # Includes shared content mapped to `name` directly in the group in which
      # it is declared, as opposed to `it_behaves_like`, which creates a nested
      # group. If given a block, that block is also eval'd in the current
      # context.
      #
      # @see SharedExampleGroup
      def self.include_context: (untyped name, *untyped args) { (?) -> untyped } -> untyped

      # Includes shared content mapped to `name` directly in the group in which
      # it is declared, as opposed to `it_behaves_like`, which creates a nested
      # group. If given a block, that block is also eval'd in the current
      # context.
      #
      # @see SharedExampleGroup
      def self.include_examples: (untyped name, *untyped args) { (?) -> untyped } -> untyped

      # Clear memoized values when adding/removing examples
      # @private
      def self.reset_memoized: () -> untyped

      # Adds an example to the example group
      def self.add_example: (untyped example) -> untyped

      # Removes an example from the example group
      def self.remove_example: (untyped example) -> untyped

      # @private
      def self.find_and_eval_shared: (untyped label, untyped name, untyped inclusion_location, *untyped args) { (?) -> untyped } -> untyped

      # @private
      def self.subclass: (untyped parent, untyped description, untyped args, untyped registration_collection) ?{ (?) -> untyped } -> untyped

      # @private
      def self.set_it_up: (untyped description, untyped args, untyped registration_collection) { (?) -> untyped } -> untyped

      # @private
      def self.examples: () -> untyped

      # @private
      def self.filtered_examples: () -> untyped

      # @private
      def self.descendant_filtered_examples: () -> untyped

      # @private
      def self.children: () -> untyped

      # @private
      # Traverses the tree of groups, starting with `self`, then the children, recursively.
      # Halts the traversal of a branch of the tree as soon as the passed block returns true.
      # Note that siblings groups and their sub-trees will continue to be explored.
      # This is intended to make it easy to find the top-most group that satisfies some
      # condition.
      def self.traverse_tree_until: () { (untyped) -> untyped } -> (nil | untyped)

      # @private
      def self.next_runnable_index_for: (untyped file) -> untyped

      # @private
      def self.descendants: () -> untyped

      #  @private
      def self.parent_groups: () -> untyped

      # @private
      def self.top_level?: () -> untyped

      # @private
      def self.ensure_example_groups_are_configured: () -> (untyped | nil)

      # @private
      def self.before_context_ivars: () -> untyped

      # @private
      def self.store_before_context_ivars: (untyped example_group_instance) -> untyped

      # Returns true if a `before(:context)` or `after(:context)`
      # hook is currently executing.
      def self.currently_executing_a_context_hook?: () -> untyped

      # @private
      def self.run_before_context_hooks: (untyped example_group_instance) -> untyped

      # @private
      def self.superclass_before_context_ivars: () -> untyped

      # @private
      def self.run_after_context_hooks: (untyped example_group_instance) -> untyped

      # Runs all the examples in this group.
      def self.run: (?untyped reporter) -> (nil | untyped)

      # @private
      def self.ordering_strategy: () -> untyped

      # @private
      def self.run_examples: (untyped reporter) -> untyped

      # @private
      def self.for_filtered_examples: (untyped reporter) { (?) -> untyped } -> false

      # @private
      def self.declaration_locations: () -> untyped

      # @return [String] the unique id of this example group. Pass
      #   this at the command line to re-run this exact example group.
      def self.id: () -> untyped

      # @private
      def self.top_level_description: () -> untyped

      # @private
      def self.set_ivars: (untyped instance, untyped ivars) -> untyped

      # :nocov:
      # @private
      INSTANCE_VARIABLE_TO_IGNORE: "@__inspect_output"

      # @private
      INSTANCE_VARIABLE_TO_IGNORE: :@__inspect_output

      # @private
      def self.each_instance_variable_for_example: (untyped group) { (untyped) -> untyped } -> untyped

      # @private
      def initialize: (?untyped? inspect_output) -> void

      # @private
      def inspect: () -> ::String

      # :nocov:
      # @private
      def singleton_class: () -> untyped

      # @private
      def self.update_inherited_metadata: (untyped updates) -> untyped

      # Raised when an RSpec API is called in the wrong scope, such as `before`
      # being called from within an example rather than from within an example
      # group block.
      WrongScopeError: untyped

      def self.method_missing: (untyped name, *untyped args) -> untyped

      private

      def method_missing: (untyped name, *untyped args) -> untyped
    end

    # @private
    # Unnamed example group used by `SuiteHookContext`.
    class AnonymousExampleGroup < ExampleGroup
      def self.metadata: () -> ::Hash[untyped, untyped]
    end

    # Contains information about the inclusion site of a shared example group.
    class SharedExampleGroupInclusionStackFrame
      @shared_group_name: untyped

      @inclusion_location: untyped

      @formatted_inclusion_location: untyped

      @description: untyped

      # @return [String] the name of the shared example group
      attr_reader shared_group_name: untyped

      # @return [String] the location where the shared example was included
      attr_reader inclusion_location: untyped

      # @private
      def initialize: (untyped shared_group_name, untyped inclusion_location) -> void

      # @return [String] The {#inclusion_location}, formatted for display by a formatter.
      def formatted_inclusion_location: () -> untyped

      # @return [String] Description of this stack frame, in the form used by
      #   RSpec's built-in formatters.
      def description: () -> untyped

      # @private
      def self.current_backtrace: () -> untyped

      # @private
      def self.with_frame: (untyped name, untyped location) { () -> untyped } -> untyped

      # @private
      def self.shared_example_group_inclusions: () -> untyped
    end
  end

  # @private
  #
  # Namespace for the example group subclasses generated by top-level
  # `describe`.
  module ExampleGroups
    extend Support::RecursiveConstMethods

    def self.assign_const: (untyped group) -> untyped

    def self.constant_scope_for: (untyped group) -> untyped

    def self.remove_all_constants: () -> untyped

    def self.base_name_for: (untyped group) -> ("Anonymous" | untyped)

    alias self._base_name_for self.base_name_for

    def self.base_name_for: (untyped group) -> untyped

    def self.disambiguate: (untyped name, untyped const_scope) -> untyped
  end
end
